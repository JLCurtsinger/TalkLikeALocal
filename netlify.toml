[build]
# 1) root deps, 2) root build, 3) conditional blog build
command = """
npm ci && \
npm run build && \
if git diff --quiet HEAD^ HEAD -- blog; then \
  echo 'Blog unchanged: skipping blog install/build.'; \
else \
  npm --prefix ./blog ci --no-audit --no-fund --prefer-offline && \
  npm --prefix ./blog run build && \
  mkdir -p dist/blog && cp -R blog/dist/* dist/blog; \
fi
"""
publish = "dist"

[build.environment]
NODE_VERSION = "20"

[[redirects]]
  from = "/ads.txt"
  to = "/ads.txt"
  status = 200
  force = true

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200